"use strict";(self.webpackChunkdevops4solution=self.webpackChunkdevops4solution||[]).push([[540],{1873:(e,t,n)=>{n(6540)},5680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>y});var a=n(6540);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},g=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,g=i(e,["components","mdxType","originalType","parentName"]),c=p(n),u=l,y=c["".concat(s,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(y,o(o({ref:t},g),{},{components:n})):a.createElement(y,o({ref:t},g))}));function y(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:l,o[1]=i;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9046:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var a=n(8168),l=(n(6540),n(5680));n(1873);const r={title:"Kubernetes Controllers Explained with Examples",date:"2020-12-20",categories:["devops-tools"]},o=void 0,i={unversionedId:"Kubernetes/controllers",id:"Kubernetes/controllers",title:"Kubernetes Controllers Explained with Examples",description:"In this blog, we will explore the concept of Kubernetes Controllers and how to use them to create replicated Deployments. We will also explore which controller should we use for a specific use case.",source:"@site/docs/Kubernetes/controllers.md",sourceDirName:"Kubernetes",slug:"/Kubernetes/controllers",permalink:"/docs/Kubernetes/controllers",draft:!1,editUrl:"https://devops4solutions.com/docs/edit/main/docs/Kubernetes/controllers.md",tags:[],version:"current",frontMatter:{title:"Kubernetes Controllers Explained with Examples",date:"2020-12-20",categories:["devops-tools"]},sidebar:"tutorialSidebar",previous:{title:"configmaps",permalink:"/docs/Kubernetes/configmaps"},next:{title:"What is Kubernetes ?",permalink:"/docs/Kubernetes/intro-kubernetes"}},s={},p=[{value:"<strong>Why controllers\xa0?</strong>",id:"why-controllers",level:3},{value:"<strong>ReplicaSets</strong>",id:"replicasets",level:3},{value:"Creating a Simple ReplicaSet with nginx Containers",id:"creating-a-simple-replicaset-with-nginx-containers",level:3},{value:"Deleting Pods Managed by a ReplicaSet",id:"deleting-pods-managed-by-a-replicaset",level:3},{value:"Creating a ReplicaSet Given That a Matching Pod Already\xa0Exists",id:"creating-a-replicaset-given-that-a-matching-pod-alreadyexists",level:3},{value:"<strong>Scale your replicas</strong>",id:"scale-your-replicas",level:4},{value:"<strong>Deployment</strong>",id:"deployment",level:3},{value:"<strong>Few Use cases</strong>",id:"few-use-cases",level:4},{value:"<strong>Strategy</strong>",id:"strategy",level:4},{value:"<strong>RollingUpdate ( default)</strong>",id:"rollingupdate--default",level:5},{value:"<strong>Recreate</strong>",id:"recreate",level:5},{value:"Creating a Simple Deployment with Nginx Containers",id:"creating-a-simple-deployment-with-nginx-containers",level:3},{value:"Rolling Back a Deployment",id:"rolling-back-a-deployment",level:3},{value:"StatefulSets",id:"statefulsets",level:3},{value:"<strong>How stateful replicas work\xa0?</strong>",id:"how-stateful-replicas-work",level:4},{value:"USE CASES FOR STATEFULSETS",id:"use-cases-for-statefulsets",level:4},{value:"Daemon Sets",id:"daemon-sets",level:3},{value:"Use Cases for DaemonSets",id:"use-cases-for-daemonsets",level:4},{value:"<strong>Jobs</strong>",id:"jobs",level:3},{value:"<strong>Conclusion:</strong>",id:"conclusion",level:3}],g={toc:p},c="wrapper";function m(e){let{components:t,...n}=e;return(0,l.yg)(c,(0,a.A)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,l.yg)("p",null,"In this blog, we will explore the concept of Kubernetes Controllers and how to use them to create replicated Deployments. We will also explore which controller should we use for a specific use case."),(0,l.yg)("p",null,"Check out my ",(0,l.yg)("a",{parentName:"p",href:"https://youtu.be/8vU12Lx2PvQ"},"YouTube")," video on this blog"),(0,l.yg)("p",null,(0,l.yg)("strong",{parentName:"p"},"Prerequisite"),":"),(0,l.yg)("ol",null,(0,l.yg)("li",{parentName:"ol"},"Functional ",(0,l.yg)("a",{parentName:"li",href:"https://devops4solutions.com/setup-kubernetes-cluster-in-gcp/"},"Kubernetes Cluster")," configured"),(0,l.yg)("li",{parentName:"ol"},"Kubernetes\u2019 command-line tool, kubectl, which is the command-line interface for running commands against Kubernetes clusters."),(0,l.yg)("li",{parentName:"ol"},"Clone ",(0,l.yg)("a",{parentName:"li",href:"https://github.com/devops4solutions/kubernetes-sample-deployment"},"this")," git repo for all the yaml files which we will be using in this blog")),(0,l.yg)("p",null,"There are different kinds of controllers"),(0,l.yg)("ol",null,(0,l.yg)("li",{parentName:"ol"},(0,l.yg)("em",{parentName:"li"},"ReplicaSets,")),(0,l.yg)("li",{parentName:"ol"},(0,l.yg)("em",{parentName:"li"},"Deployments,")),(0,l.yg)("li",{parentName:"ol"},(0,l.yg)("em",{parentName:"li"},"DaemonSets")),(0,l.yg)("li",{parentName:"ol"},(0,l.yg)("em",{parentName:"li"},"StatefulSets")),(0,l.yg)("li",{parentName:"ol"},"Jobs")),(0,l.yg)("h3",{id:"why-controllers"},(0,l.yg)("strong",{parentName:"h3"},"Why controllers\xa0?")),(0,l.yg)("p",null,"In my previous ",(0,l.yg)("a",{parentName:"p",href:"https://devops4solutions.com/kubernetes-pods-explained-with-examples/"},"blog")," we have seen how to create a pod and manage its lifecycle manually.\xa0"),(0,l.yg)("p",null,"There are various reasons you want to use controllers such as\xa0"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Create more than one replica of your pods so that when one pod is down, application can still run on the different pod"),(0,l.yg)("li",{parentName:"ul"},"Load Balance across different pods so that an end user will not see any slowness in their application.")),(0,l.yg)("p",null,"A controller is an object that ensures that your application runs in the desired state for its entire runtime"),(0,l.yg)("h3",{id:"replicasets"},(0,l.yg)("strong",{parentName:"h3"},"ReplicaSets")),(0,l.yg)("p",null,"A ReplicaSet is a Kubernetes controller that keeps a certain number of Pods running at any given time."),(0,l.yg)("p",null,"It will terminate or start new Pods to match the configuration specified in the ReplicaSet template"),(0,l.yg)("p",null,"It can be used to reliably run a single Pod indefinitely or to run multiple instances of the same Pod."),(0,l.yg)("h3",{id:"creating-a-simple-replicaset-with-nginx-containers"},"Creating a Simple ReplicaSet with nginx Containers"),(0,l.yg)("p",null,"In this yaml file, we have three fields"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Replicas"),(0,l.yg)("li",{parentName:"ul"},"Selector"),(0,l.yg)("li",{parentName:"ul"},"Template")),(0,l.yg)("p",null,"apiVersion: apps/v1",(0,l.yg)("br",{parentName:"p"}),"\n","kind: ReplicaSet",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","name: nginx-replicaset",(0,l.yg)("br",{parentName:"p"}),"\n","labels:",(0,l.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","",(0,l.yg)("strong",{parentName:"p"},"replicas"),": 2 #pod selector",(0,l.yg)("br",{parentName:"p"}),"\n","",(0,l.yg)("strong",{parentName:"p"},"selector"),":",(0,l.yg)("br",{parentName:"p"}),"\n","matchLabels:",(0,l.yg)("br",{parentName:"p"}),"\n","environment: production",(0,l.yg)("br",{parentName:"p"}),"\n","",(0,l.yg)("strong",{parentName:"p"},"template"),": # pod template",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","labels:",(0,l.yg)("br",{parentName:"p"}),"\n","environment: production",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","containers:  "),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"  - name: nginx-container  \n    image: nginx\n")),(0,l.yg)("p",null,"Create a replicaSet"),(0,l.yg)("p",null,"kubectl create -f replicaSets.yaml",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get rs nginx-replicaset",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get pods",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl describe rs nginx-replicaset"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*T16jNXyOCPejacNdgNIkew.png",alt:null})),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*_8FJRvPCR2d8X1YqLbt0Xg.png",alt:null})),(0,l.yg)("p",null,"We can also check the pod configuration"),(0,l.yg)("p",null,"kubectl describe pod podname"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*GksL1dhLAgeWGoTtXotQXA.png",alt:null})),(0,l.yg)("h3",{id:"deleting-pods-managed-by-a-replicaset"},"Deleting Pods Managed by a ReplicaSet"),(0,l.yg)("p",null,"Let\u2019s try to delete a pod"),(0,l.yg)("p",null,"kubectl delete pod nginx-replicaset-lxxlv"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*oCg30J9fcX_Tvj54X8Hqxg.png",alt:null})),(0,l.yg)("p",null,"Now again check the pods"),(0,l.yg)("p",null,"kubectl get pods"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*p7v97K4DZH2_tVYxropuZg.png",alt:null})),(0,l.yg)("p",null,"we can see that after a Pod is deleted, the ReplicaSet creates a new Pod using the Pod configuration. Even if we delete all the Pods managed by the ReplicaSet, they will be recreated.\xa0"),(0,l.yg)("p",null,"So, to delete all the Pods permanently and to avoid the recreation of the Pods, we need to delete the ReplicaSet itself."),(0,l.yg)("p",null,"kubectl delete rs nginx-replicaset"),(0,l.yg)("h3",{id:"creating-a-replicaset-given-that-a-matching-pod-alreadyexists"},"Creating a ReplicaSet Given That a Matching Pod Already\xa0Exists"),(0,l.yg)("p",null,"First we will create a POD"),(0,l.yg)("p",null,"kind: Pod",(0,l.yg)("br",{parentName:"p"}),"\n","apiVersion: v1",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","name: pod-matching-rs",(0,l.yg)("br",{parentName:"p"}),"\n","labels:",(0,l.yg)("br",{parentName:"p"}),"\n","environment: production",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","containers:  "),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"name: first-container",(0,l.yg)("br",{parentName:"li"}),"image: nginx")),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*HXUn4fXZciXXqtRl-R3ZuQ.png",alt:null})),(0,l.yg)("p",null,"Now we will run our previous yaml which will create a replicaSet object and run the two pods"),(0,l.yg)("p",null,"kubectl create -f replicaSets.yaml",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get pods"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*jtQFpw5cpmxBPgHEob60iA.png",alt:null})),(0,l.yg)("p",null,"You can check whether the manual pod is managed by ReplicaSet or not"),(0,l.yg)("p",null,"kubectl describe pod pod-matching-rs"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*SKiQEyQcFr-7L0hum8mv_A.png",alt:null})),(0,l.yg)("p",null,"so now when you delete the replicaSet then all pods will get deleted"),(0,l.yg)("p",null,"kubectl delete rs nginx-replicaset"),(0,l.yg)("h4",{id:"scale-your-replicas"},(0,l.yg)("strong",{parentName:"h4"},"Scale your replicas")),(0,l.yg)("p",null,"kubectl scale --replicas=4 rs nginx-replicaset"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*tyLpQHCKfQk2yUsJLPQqig.png",alt:null})),(0,l.yg)("p",null,"We have learnt how to use the ReplicaSet and when we should use this."),(0,l.yg)("h3",{id:"deployment"},(0,l.yg)("strong",{parentName:"h3"},"Deployment")),(0,l.yg)("p",null,"A Deployment is a Kubernetes object that acts as a wrapper around a ReplicaSet and makes it easier to use."),(0,l.yg)("p",null,"It is recommended that we use Deployments that will manage the ReplicaSet and the Pods created by the ReplicaSet."),(0,l.yg)("h4",{id:"few-use-cases"},(0,l.yg)("strong",{parentName:"h4"},"Few Use cases")),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Deployment maintains a history of revisions"),(0,l.yg)("li",{parentName:"ul"},"A new revision is created whenever you change anything in replica or pod configuration"),(0,l.yg)("li",{parentName:"ul"},"Easily rollback to the previous version"),(0,l.yg)("li",{parentName:"ul"},"Each rollback also creates a new revision")),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*hyIJbaMwLuKxaJ2YOheSUg.png",alt:null})),(0,l.yg)("h4",{id:"strategy"},(0,l.yg)("strong",{parentName:"h4"},"Strategy")),(0,l.yg)("p",null,"In the deployment spec we can specify which strategy the Deployment should use when it replaces old pods with new ones."),(0,l.yg)("p",null,"Two Types of Strategies"),(0,l.yg)("h5",{id:"rollingupdate--default"},(0,l.yg)("strong",{parentName:"h5"},"RollingUpdate ( default)")),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Updates the deployment without downtime"),(0,l.yg)("li",{parentName:"ul"},"Controller updates the pod one by one that means every time at least one pod is always running"),(0,l.yg)("li",{parentName:"ul"},"With rolling update, there is a chance that at a particular time two versions(old and new) are running for your application. If your application is just serving the static information then this should be fine"),(0,l.yg)("li",{parentName:"ul"},"In general, we can use ",(0,l.yg)("strong",{parentName:"li"},"RollingUpdate")," for applications for which the data stored by a new version can be read and handled by the old version of the application.")),(0,l.yg)("p",null,"spec:",(0,l.yg)("br",{parentName:"p"}),"\n","replicas: 3",(0,l.yg)("br",{parentName:"p"}),"\n","",(0,l.yg)("strong",{parentName:"p"},"strategy"),":",(0,l.yg)("br",{parentName:"p"}),"\n","type: RollingUpdate",(0,l.yg)("br",{parentName:"p"}),"\n","rollingUpdate:",(0,l.yg)("br",{parentName:"p"}),"\n","maxUnavailable: 1",(0,l.yg)("br",{parentName:"p"}),"\n","maxSurge: 1"),(0,l.yg)("p",null,(0,l.yg)("inlineCode",{parentName:"p"},"maxUnavailable:")," This means maximum number of pods can go unavailable while doing the update. You can specify this value either as an ",(0,l.yg)("inlineCode",{parentName:"p"},"integer")," or a string representing the percentage of total replicas that can be unavailable."),(0,l.yg)("p",null,"The default value for ",(0,l.yg)("strong",{parentName:"p"},"maxUnavailable")," is ",(0,l.yg)("strong",{parentName:"p"},"25%"),"."),(0,l.yg)("p",null,(0,l.yg)("inlineCode",{parentName:"p"},"maxSurge:")," is the maximum number of Pods that can be scheduled/created above the desired number of Pods (as specified in the ",(0,l.yg)("strong",{parentName:"p"},"replicas")," field).You can specify this value either as an ",(0,l.yg)("inlineCode",{parentName:"p"},"integer")," or a percentage string."),(0,l.yg)("p",null,"The default value for ",(0,l.yg)("strong",{parentName:"p"},"maxSurge")," is also ",(0,l.yg)("strong",{parentName:"p"},"25%"),"."),(0,l.yg)("p",null,"In the above example, we are telling Kubernetes controller that while updating the pod it can create /scheduled atmost 4 pods and one pod should always be in a running state."),(0,l.yg)("h5",{id:"recreate"},(0,l.yg)("strong",{parentName:"h5"},"Recreate")),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"All the existing pods are killed before update"),(0,l.yg)("li",{parentName:"ul"},"Downtime will be there while doing the update"),(0,l.yg)("li",{parentName:"ul"},"Ensure that application is always running on one version"),(0,l.yg)("li",{parentName:"ul"},"This is useful when application can\u2019t be on different version at a particular time.")),(0,l.yg)("h3",{id:"creating-a-simple-deployment-with-nginx-containers"},"Creating a Simple Deployment with Nginx Containers"),(0,l.yg)("p",null,"apiVersion: apps/v1",(0,l.yg)("br",{parentName:"p"}),"\n","kind: Deployment",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","name: nginx-deployment",(0,l.yg)("br",{parentName:"p"}),"\n","labels:",(0,l.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","replicas: 3",(0,l.yg)("br",{parentName:"p"}),"\n","selector:",(0,l.yg)("br",{parentName:"p"}),"\n","matchLabels:",(0,l.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,l.yg)("br",{parentName:"p"}),"\n","environment: production",(0,l.yg)("br",{parentName:"p"}),"\n","template:",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","labels:",(0,l.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,l.yg)("br",{parentName:"p"}),"\n","environment: production",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","containers:  "),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"  - name: nginx-container  \n    image: nginx\n")),(0,l.yg)("p",null,"Create a Deployment"),(0,l.yg)("p",null,"kubectl create -f deployment.yaml",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get deployment nginx-deployment"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*3ChsKk-IELHY6-TiacNKzQ.png",alt:null})),(0,l.yg)("p",null,"Deployment -> Replica Set -> 3 pods"),(0,l.yg)("p",null,"This is how the naming convention also works.\xa0"),(0,l.yg)("h3",{id:"rolling-back-a-deployment"},"Rolling Back a Deployment"),(0,l.yg)("p",null,"\xa0We can run the below command to check the revision history and rollback."),(0,l.yg)("p",null,"We should use ",(0,l.yg)("inlineCode",{parentName:"p"},"-record"),"when we use any ",(0,l.yg)("strong",{parentName:"p"},"apply")," or ",(0,l.yg)("strong",{parentName:"p"},"set")," commands to modify the Deployment. This flag records the rollout history."),(0,l.yg)("p",null,"kubectl rollout history deployment <deployment","_","name>",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl rollout undo deployment <deployment","_","name>"),(0,l.yg)("p",null,"To get more details about the deployment you can refer my blog on specifically ",(0,l.yg)("a",{parentName:"p",href:"https://devops4solutions.com/understand-kubernetes-object-and-create-nginx-deployment/"},"Deployment object")),(0,l.yg)("h3",{id:"statefulsets"},"StatefulSets"),(0,l.yg)("p",null,"This is used to manage the stateful replicas. This is similar like Deployment which creates and manages the PODS as per the configuration."),(0,l.yg)("h4",{id:"how-stateful-replicas-work"},(0,l.yg)("strong",{parentName:"h4"},"How stateful replicas work\xa0?")),(0,l.yg)("p",null,"It maintains a unique identity of the pods. Each pod is different and cannot be interchangeable."),(0,l.yg)("p",null,"Each of the Pods has a sticky identity that can be used by the application code to manage the state of the application on a particular Pod.\xa0"),(0,l.yg)("p",null,"\xa0The names of the Pods reflect the integer identity assigned to them. When a StatefulSet is created, all the Pods are created in the order of their integer ordinal."),(0,l.yg)("p",null,"Each of the Pods managed by a StatefulSet will persist their sticky identity (integer ordinal) even if the Pod restarts.\xa0"),(0,l.yg)("p",null,"For example, if a particular Pod crashes or is deleted, a new Pod will be created and assigned the same sticky identity as that of the old Pod."),(0,l.yg)("h4",{id:"use-cases-for-statefulsets"},"USE CASES FOR STATEFULSETS"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"For the persistent storage. Using a StatefulSet, you can partition the data and store it in different Pods. In this case, it would also be possible for a Pod to go down and a new Pod come up with the same identity and have the same partition of data previously stored by the old Pod.")),(0,l.yg)("h3",{id:"daemon-sets"},"Daemon Sets"),(0,l.yg)("p",null,"When you want to manage the creation of pods on a selected or on all the nodes that this object is being used."),(0,l.yg)("p",null,"If we configure a Daemon Set to create Pods on all nodes, then if new nodes are added to the cluster, new pods will be created to run on these new nodes. Similarly, if some nodes are removed from the cluster, the Pods running on these nodes will be destroyed."),(0,l.yg)("h4",{id:"use-cases-for-daemonsets"},"Use Cases for DaemonSets"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"Logging"),": We need to run a logging pods on all the nodes so that we can collect metrics from all of them"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"Local data caching"),": A DaemonSet can also be used to manage caching Pods on all the nodes. These Pods can be used by other application Pods to store the cached data temporarily."),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("strong",{parentName:"li"},"Monitoring"),": Another use case for a DaemonSet is to manage running monitoring Pods on all the nodes.\xa0")),(0,l.yg)("p",null,"All of these controllers ",(0,l.yg)("strong",{parentName:"p"},"(ReplicaSets, Deployment, Statefulets and Daemon Sets)")," have one common characteristic\u200a\u2014\u200athey are useful for applications or workloads that are running continuously.\xa0"),(0,l.yg)("p",null,"However, sometimes we just want to run a specific pod for a specific task and once the task is complete then we don\u2019t need that pod. For this purpose, Kubernetes provides an object called ",(0,l.yg)("inlineCode",{parentName:"p"},"Job")),(0,l.yg)("h3",{id:"jobs"},(0,l.yg)("strong",{parentName:"h3"},"Jobs")),(0,l.yg)("p",null,"Jobs can be used to manage Pods that are supposed to run a determined task and then terminate gracefully."),(0,l.yg)("p",null,(0,l.yg)("strong",{parentName:"p"},"Create a Job")),(0,l.yg)("p",null,"apiVersion: batch/v1",(0,l.yg)("br",{parentName:"p"}),"\n","kind: Job",(0,l.yg)("br",{parentName:"p"}),"\n","metadata:",(0,l.yg)("br",{parentName:"p"}),"\n","name: one-time-job",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","template:",(0,l.yg)("br",{parentName:"p"}),"\n","spec:",(0,l.yg)("br",{parentName:"p"}),"\n","containers:  "),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},'  - name: busybox-container  \n    image: busybox  \n    args:  \n    - /bin/sh  \n    - -c  \n    - date; sleep 20; echo "Bye"  \n  restartPolicy: OnFailure\n')),(0,l.yg)("p",null,"Create a pod"),(0,l.yg)("p",null,"kubectl apply -f jobs.yaml",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get jobs",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl get pods",(0,l.yg)("br",{parentName:"p"}),"\n","kubectl logs -f one-time-job"),(0,l.yg)("p",null,(0,l.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*gEoPt4KgImLu-gurSBO9jA.png",alt:null})),(0,l.yg)("p",null,"In the above screenshot, you can see that pod is in ",(0,l.yg)("inlineCode",{parentName:"p"},"completed")," state and job is also successful."),(0,l.yg)("h3",{id:"conclusion"},(0,l.yg)("strong",{parentName:"h3"},"Conclusion:")),(0,l.yg)("p",null,"We have successfully learnt all the Kubernetes objects using examples."),(0,l.yg)("p",null,"Want to learn more on Kubernetes, refer my ",(0,l.yg)("a",{parentName:"p",href:"https://devops4solutions.com/category/kubernetes/"},"website")))}m.isMDXComponent=!0}}]);