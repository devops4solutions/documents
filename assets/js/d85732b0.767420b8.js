"use strict";(self.webpackChunkdevops4solution=self.webpackChunkdevops4solution||[]).push([[194],{1873:(e,t,n)=>{n(6540)},5680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>c});var l=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,l,o=function(e,t){if(null==e)return{};var n,l,o={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=l.createContext({}),s=function(e){var t=l.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},g=function(e){var t=s(e.components);return l.createElement(p.Provider,{value:t},e.children)},u="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},m=l.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,g=i(e,["components","mdxType","originalType","parentName"]),u=s(n),m=o,c=u["".concat(p,".").concat(m)]||u[m]||y[m]||r;return n?l.createElement(c,a(a({ref:t},g),{},{components:n})):l.createElement(c,a({ref:t},g))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:o,a[1]=i;for(var s=2;s<r;s++)a[s]=n[s];return l.createElement.apply(null,a)}return l.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6815:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>y,frontMatter:()=>r,metadata:()=>i,toc:()=>s});var l=n(8168),o=(n(6540),n(5680));n(1873);const r={title:"Understand Kubernetes Object and Create Nginx Deployment",date:"2020-12-01",categories:["kubernetes"]},a=void 0,i={unversionedId:"Kubernetes/objects",id:"Kubernetes/objects",title:"Understand Kubernetes Object and Create Nginx Deployment",description:"In this blog, we will explore Kubernetes Objects\xa0,learn about how to create a Nginx deployment using yaml file.",source:"@site/docs/Kubernetes/objects.md",sourceDirName:"Kubernetes",slug:"/Kubernetes/objects",permalink:"/docs/Kubernetes/objects",draft:!1,editUrl:"https://devops4solutions.github.io/docs/edit/main/docs/Kubernetes/objects.md",tags:[],version:"current",frontMatter:{title:"Understand Kubernetes Object and Create Nginx Deployment",date:"2020-12-01",categories:["kubernetes"]},sidebar:"tutorialSidebar",previous:{title:"Kubernetes Labels and Annotation",permalink:"/docs/Kubernetes/labels-and-annotations"},next:{title:"Exposing Kubernetes Applications using\xa0Services",permalink:"/docs/Kubernetes/services"}},p={},s=[{value:"<strong>Prerequisite</strong>",id:"prerequisite",level:3},{value:"<strong>Kubernetes Objects</strong>",id:"kubernetes-objects",level:3},{value:"Deploying workloads using YAML\xa0files",id:"deploying-workloads-using-yamlfiles",level:3},{value:"<strong>Agenda</strong>:",id:"agenda",level:3},{value:"Kubernetes: <strong>Creating a Deployment</strong>",id:"kubernetes-creating-a-deployment",level:3},{value:"<strong>Verify the Deployment</strong>",id:"verify-the-deployment",level:4},{value:"<strong>Edit the Deployment</strong>",id:"edit-the-deployment",level:4},{value:"<strong>Rolling Back Deployment</strong>",id:"rolling-back-deployment",level:4},{value:"<strong>Deleting a deployment</strong>",id:"deleting-a-deployment",level:4}],g={toc:s},u="wrapper";function y(e){let{components:t,...n}=e;return(0,o.yg)(u,(0,l.A)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"In this blog, we will explore Kubernetes Objects\xa0,learn about how to create a Nginx deployment using yaml file."),(0,o.yg)("p",null,"Check out the\xa0",(0,o.yg)("a",{parentName:"p",href:"https://youtu.be/xToovqJ92Bc"},"YouTube")," video for this article"),(0,o.yg)("p",null,"We will also learn how to rollback the deployment and how the revision number changed when we do the rollback."),(0,o.yg)("h3",{id:"prerequisite"},(0,o.yg)("strong",{parentName:"h3"},"Prerequisite")),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"Kubernetes Cluster should be configured"),(0,o.yg)("li",{parentName:"ol"},"Kubectl configured")),(0,o.yg)("p",null,"Follow my YouTube ",(0,o.yg)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=giqor4kam6Y"},"video")," or ",(0,o.yg)("a",{parentName:"p",href:"https://devops4solutions.com/setup-kubernetes-cluster-in-gcp/"},"blog")," to setup the prerequisite."),(0,o.yg)("h3",{id:"kubernetes-objects"},(0,o.yg)("strong",{parentName:"h3"},"Kubernetes Objects")),(0,o.yg)("p",null,"_T_hese are persistent entities in the Kubernetes system. Kubernetes uses these entities to represent the state of your cluster."),(0,o.yg)("p",null,"A Kubernetes object is a \u201crecord of intent\u201d\u200a\u2014\u200aonce you create the object, the Kubernetes system will constantly work to ensure that object exists.\xa0"),(0,o.yg)("p",null,"By creating an object, you\u2019re effectively telling the Kubernetes system what you want your cluster\u2019s workload to look like; this is your cluster\u2019s ",(0,o.yg)("em",{parentName:"p"},"desired state"),"."),(0,o.yg)("p",null,"Kubernetes object includes two nested object fields that govern the object\u2019s configuration: the object ",(0,o.yg)("inlineCode",{parentName:"p"},"_spec_")," and the object ",(0,o.yg)("inlineCode",{parentName:"p"},"_status_")),(0,o.yg)("h3",{id:"deploying-workloads-using-yamlfiles"},"Deploying workloads using YAML\xa0files"),(0,o.yg)("p",null,"We will create the resource configurations required to deploy your applications in Kubernetes"),(0,o.yg)("p",null,"Make sure you have a Kubernetes cluster ready and kubectl configured to manage the cluster resources."),(0,o.yg)("h3",{id:"agenda"},(0,o.yg)("strong",{parentName:"h3"},"Agenda"),":"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Creating a Deployment"),(0,o.yg)("li",{parentName:"ul"},"Verifying a Deployment"),(0,o.yg)("li",{parentName:"ul"},"Editing a Deployment"),(0,o.yg)("li",{parentName:"ul"},"Rolling back a Deployment"),(0,o.yg)("li",{parentName:"ul"},"Deleting a Deployment")),(0,o.yg)("h3",{id:"kubernetes-creating-a-deployment"},"Kubernetes: ",(0,o.yg)("strong",{parentName:"h3"},"Creating a Deployment")),(0,o.yg)("p",null,"A Deployment is an object that actually represents your application which is running on the cluster"),(0,o.yg)("p",null,"We will create a Deployment using a yaml file where we will have configurations defined for our application like images, port, pods etc."),(0,o.yg)("p",null,"So let\u2019s create a sample yaml file for the nginx deployment. You can also refer the git ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/devops4solutions/kubernetes-sample-deployment/blob/main/nginx.yaml"},"repo")," for this yaml file"),(0,o.yg)("p",null,"apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2",(0,o.yg)("br",{parentName:"p"}),"\n","kind: Deployment",(0,o.yg)("br",{parentName:"p"}),"\n","metadata:",(0,o.yg)("br",{parentName:"p"}),"\n","name: nginx-deployment",(0,o.yg)("br",{parentName:"p"}),"\n","spec:",(0,o.yg)("br",{parentName:"p"}),"\n","selector:",(0,o.yg)("br",{parentName:"p"}),"\n","matchLabels:",(0,o.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,o.yg)("br",{parentName:"p"}),"\n","replicas: 2 # tells deployment to run 2 pods matching the template",(0,o.yg)("br",{parentName:"p"}),"\n","template:",(0,o.yg)("br",{parentName:"p"}),"\n","metadata:",(0,o.yg)("br",{parentName:"p"}),"\n","labels:",(0,o.yg)("br",{parentName:"p"}),"\n","app: nginx",(0,o.yg)("br",{parentName:"p"}),"\n","spec:",(0,o.yg)("br",{parentName:"p"}),"\n","containers:  "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"  - name: nginx  \n    image: nginx:1.14.2  \n    ports:  \n    - containerPort: 80\n")),(0,o.yg)("p",null,"Now, lets describe each tags in more detail"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"apiversion"),"\u200a\u2014\u200aVersion of Kubernetes API"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"kind"),"\u200a\u2014\u200aKind of object like Deployment/Service you want to create"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"metadata"),"\u200a\u2014\u200ato uniquely identify your object with tag ",(0,o.yg)("inlineCode",{parentName:"p"},"name"),"\xa0"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"spec"),"\u200a\u2014\u200aDesired state of your object by providing below details:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("inlineCode",{parentName:"li"},".spec.selector")," how the Deployment finds which Pods to manage\xa0"),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("inlineCode",{parentName:"li"},".spec.replicas")," how many pods")),(0,o.yg)("p",null,"For more details on deployment refer their ",(0,o.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/"},"official")," documentation"),(0,o.yg)("p",null,"Now Let\u2019s create a deployment object using the yaml file"),(0,o.yg)("p",null," ",(0,o.yg)("inlineCode",{parentName:"p"},"\u2014\u200a-record")," This flag is used to write the command executed in the resource annotation ",(0,o.yg)("inlineCode",{parentName:"p"},"kubernetes.io/change-cause"),".\xa0"),(0,o.yg)("p",null,"kubectl apply -f ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/devops4solutions/kubernetes-sample-deployment/blob/main/nginx.yaml"},"n"),"ginx.yaml --record=true"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*l8-N7oxW7ubFj2ktTqOtdg.png",alt:null})),(0,o.yg)("p",null,"Now if you run the rollout history you will see the message\xa0"),(0,o.yg)("p",null,"kubectl rollout history deployment.v1.apps/nginx-deployment"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*UCmHZ7NtNxDrp9BfawBtKw.png",alt:null})),(0,o.yg)("h4",{id:"verify-the-deployment"},(0,o.yg)("strong",{parentName:"h4"},"Verify the Deployment")),(0,o.yg)("p",null,"Let\u2019s check the status of the deployment"),(0,o.yg)("p",null,"kubectl get deployment"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*nU4LlXsO8iipwItWtMP6fA.png",alt:null})),(0,o.yg)("p",null,"Check the deployment status"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"kubectl rollout status deployment nginx-deployment")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*95ng-xNdYz3ZsHufhppACg.png",alt:null})),(0,o.yg)("p",null,"Check the replica sets and pods which got deployed as part of this deployment"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Replica Set\u200a\u2014")," maintains a stable set of replica Pods running at any given time."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"kubectl get rs,pods")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*C43oa2kWLgizkLm_vN-gvQ.png",alt:null})),(0,o.yg)("h4",{id:"edit-the-deployment"},(0,o.yg)("strong",{parentName:"h4"},"Edit the Deployment")),(0,o.yg)("p",null,"Firstly, let\u2019s add the annotation which will provide the description of your change"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"CHANGE-CAUSE")," is copied from the Deployment annotation ",(0,o.yg)("inlineCode",{parentName:"p"},"kubernetes.io/change-cause")," to its revisions upon creation. You can specify the",(0,o.yg)("inlineCode",{parentName:"p"},"CHANGE-CAUSE")," message by:"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},'kubectl annotate deployment nginx-deployment kubernetes.io/change-cause="initial deployment"')),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"kubectl rollout history deployment.v1.apps/nginx-deploymen")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*sGFuL0TxWCGrJGVEyCMnQg.png",alt:null})),(0,o.yg)("p",null,"Now we will try to edit the deployment and scale it to 3"),(0,o.yg)("p",null,"kubectl edit deployment nginx-deployment"),(0,o.yg)("p",null,"Now check the rolling Status, you will see only one revision because scaling the Deployment, do not create a Deployment revision. Again, edit the deployment and change the image to the some other version you will see the new revision gets created."),(0,o.yg)("p",null,"kubectl rollout history deployment.v1.apps/nginx-deployment"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*TGGloaigb43oTQ3svhCOLg.png",alt:null})),(0,o.yg)("p",null,"Describe Deployment"),(0,o.yg)("p",null,"kubectl get deployment"),(0,o.yg)("h4",{id:"rolling-back-deployment"},(0,o.yg)("strong",{parentName:"h4"},"Rolling Back Deployment")),(0,o.yg)("p",null,"By default, all of the Deployment\u2019s rollout history is kept in the system so that you can rollback anytime you want."),(0,o.yg)("p",null,"A Deployment\u2019s revision is created when a Deployment\u2019s rollout is triggered.\xa0"),(0,o.yg)("p",null,"If you update the labels or container images of the template then only a new Deployment revision gets created."),(0,o.yg)("p",null,"Other updates, such as scaling the Deployment, do not create a Deployment revision."),(0,o.yg)("p",null,"Therefore, when you do the rollback to the previous version then only pod template gets rolled back but not the pod replica. If you have 3 pods running then after rollback also 3 pods will be running."),(0,o.yg)("p",null,"Now, let\u2019s use the different image of nginx which is not available in dockerhub"),(0,o.yg)("p",null,"using below command"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1.2 --record\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/880/1*hvD6HN0RA1nKi1kXDaNRNg.png",alt:null})),(0,o.yg)("p",null,"To fix the above issue you need to revert back to the previous version"),(0,o.yg)("p",null,"kubectl rollout undo deployment nginx-deployment",(0,o.yg)("br",{parentName:"p"}),"\n",(0,o.yg)("inlineCode",{parentName:"p"},"kubectl rollout undo deployment nginx-deployment --to-revision=2")),(0,o.yg)("p",null,"Refer their official documentation for Rolling Back Deployment ",(0,o.yg)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment"},"here")),(0,o.yg)("h4",{id:"deleting-a-deployment"},(0,o.yg)("strong",{parentName:"h4"},"Deleting a deployment")),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"kubectl delete deployment nginx-deployment")),(0,o.yg)("p",null,"Congratulations, we have successfully explore Kubernetes Objects\xa0, learn about how to create a nginx deployment using yaml file."))}y.isMDXComponent=!0}}]);