<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Kubernetes/controllers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Kubernetes Controllers Explained with Examples | Devops4Solutions Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://devops4solutions.github.io/docs/Kubernetes/controllers"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kubernetes Controllers Explained with Examples | Devops4Solutions Documentation"><meta data-rh="true" name="description" content="In this blog, we will explore the concept of Kubernetes Controllers and how to use them to create replicated Deployments. We will also explore which controller should we use for a specific use case."><meta data-rh="true" property="og:description" content="In this blog, we will explore the concept of Kubernetes Controllers and how to use them to create replicated Deployments. We will also explore which controller should we use for a specific use case."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://devops4solutions.github.io/docs/Kubernetes/controllers"><link data-rh="true" rel="alternate" href="https://devops4solutions.github.io/docs/Kubernetes/controllers" hreflang="en"><link data-rh="true" rel="alternate" href="https://devops4solutions.github.io/docs/Kubernetes/controllers" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7556a39d.css">
<link rel="preload" href="/assets/js/runtime~main.17cb328f.js" as="script">
<link rel="preload" href="/assets/js/main.223e4706.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">DevOps Documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Ansible/ansible-common-usecase">Ansible</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Kubernetes/Kubernetes-pods">Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/Kubernetes-pods">Kubernetes Pods Health Check using Liveness and Readiness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/configmaps">configmaps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Kubernetes/controllers">Kubernetes Controllers Explained with Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/intro-kubernetes">What is Kubernetes ?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/kubernetes-pods-examples">Kubernetes Pods explained with examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/labels-and-annotations">Kubernetes Labels and Annotation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/objects">Understand Kubernetes Object and Create Nginx Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Kubernetes/services">Exposing Kubernetes Applications using Services</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Sonarqube/">What is Sonarqube</a><button aria-label="Toggle the collapsible sidebar category &#x27;What is Sonarqube&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kubernetes</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Kubernetes Controllers Explained with Examples</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kubernetes Controllers Explained with Examples</h1></header><p>In this blog, we will explore the concept of Kubernetes Controllers and how to use them to create replicated Deployments. We will also explore which controller should we use for a specific use case.</p><p>Check out my <a href="https://youtu.be/8vU12Lx2PvQ" target="_blank" rel="noopener noreferrer">YouTube</a> video on this blog</p><p><strong>Prerequisite</strong>:</p><ol><li>Functional <a href="https://devops4solutions.com/setup-kubernetes-cluster-in-gcp/" target="_blank" rel="noopener noreferrer">Kubernetes Cluster</a> configured</li><li>Kubernetes’ command-line tool, kubectl, which is the command-line interface for running commands against Kubernetes clusters.</li><li>Clone <a href="https://github.com/devops4solutions/kubernetes-sample-deployment" target="_blank" rel="noopener noreferrer">this</a> git repo for all the yaml files which we will be using in this blog</li></ol><p>There are different kinds of controllers</p><ol><li><em>ReplicaSets,</em></li><li><em>Deployments,</em></li><li><em>DaemonSets</em></li><li><em>StatefulSets</em></li><li>Jobs</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-controllers"><strong>Why controllers ?</strong><a href="#why-controllers" class="hash-link" aria-label="Direct link to why-controllers" title="Direct link to why-controllers">​</a></h3><p>In my previous <a href="https://devops4solutions.com/kubernetes-pods-explained-with-examples/" target="_blank" rel="noopener noreferrer">blog</a> we have seen how to create a pod and manage its lifecycle manually. </p><p>There are various reasons you want to use controllers such as </p><ul><li>Create more than one replica of your pods so that when one pod is down, application can still run on the different pod</li><li>Load Balance across different pods so that an end user will not see any slowness in their application.</li></ul><p>A controller is an object that ensures that your application runs in the desired state for its entire runtime</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replicasets"><strong>ReplicaSets</strong><a href="#replicasets" class="hash-link" aria-label="Direct link to replicasets" title="Direct link to replicasets">​</a></h3><p>A ReplicaSet is a Kubernetes controller that keeps a certain number of Pods running at any given time.</p><p>It will terminate or start new Pods to match the configuration specified in the ReplicaSet template</p><p>It can be used to reliably run a single Pod indefinitely or to run multiple instances of the same Pod.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-simple-replicaset-with-nginx-containers">Creating a Simple ReplicaSet with nginx Containers<a href="#creating-a-simple-replicaset-with-nginx-containers" class="hash-link" aria-label="Direct link to Creating a Simple ReplicaSet with nginx Containers" title="Direct link to Creating a Simple ReplicaSet with nginx Containers">​</a></h3><p>In this yaml file, we have three fields</p><ul><li>Replicas</li><li>Selector</li><li>Template</li></ul><p>apiVersion: apps/v1<br>
<!-- -->kind: ReplicaSet<br>
<!-- -->metadata:<br>
<!-- -->name: nginx-replicaset<br>
<!-- -->labels:<br>
<!-- -->app: nginx<br>
<!-- -->spec:<br>
<strong>replicas</strong>: 2 #pod selector<br>
<strong>selector</strong>:<br>
<!-- -->matchLabels:<br>
<!-- -->environment: production<br>
<strong>template</strong>: # pod template<br>
<!-- -->metadata:<br>
<!-- -->labels:<br>
<!-- -->environment: production<br>
<!-- -->spec:<br>
<!-- -->containers:  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx-container  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a replicaSet</p><p>kubectl create -f replicaSets.yaml<br>
<!-- -->kubectl get rs nginx-replicaset<br>
<!-- -->kubectl get pods<br>
<!-- -->kubectl describe rs nginx-replicaset</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*T16jNXyOCPejacNdgNIkew.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*_8FJRvPCR2d8X1YqLbt0Xg.png" class="img_ev3q"></p><p>We can also check the pod configuration</p><p>kubectl describe pod podname</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*GksL1dhLAgeWGoTtXotQXA.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deleting-pods-managed-by-a-replicaset">Deleting Pods Managed by a ReplicaSet<a href="#deleting-pods-managed-by-a-replicaset" class="hash-link" aria-label="Direct link to Deleting Pods Managed by a ReplicaSet" title="Direct link to Deleting Pods Managed by a ReplicaSet">​</a></h3><p>Let’s try to delete a pod</p><p>kubectl delete pod nginx-replicaset-lxxlv</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*oCg30J9fcX_Tvj54X8Hqxg.png" class="img_ev3q"></p><p>Now again check the pods</p><p>kubectl get pods</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*p7v97K4DZH2_tVYxropuZg.png" class="img_ev3q"></p><p>we can see that after a Pod is deleted, the ReplicaSet creates a new Pod using the Pod configuration. Even if we delete all the Pods managed by the ReplicaSet, they will be recreated. </p><p>So, to delete all the Pods permanently and to avoid the recreation of the Pods, we need to delete the ReplicaSet itself.</p><p>kubectl delete rs nginx-replicaset</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-replicaset-given-that-a-matching-pod-alreadyexists">Creating a ReplicaSet Given That a Matching Pod Already Exists<a href="#creating-a-replicaset-given-that-a-matching-pod-alreadyexists" class="hash-link" aria-label="Direct link to Creating a ReplicaSet Given That a Matching Pod Already Exists" title="Direct link to Creating a ReplicaSet Given That a Matching Pod Already Exists">​</a></h3><p>First we will create a POD</p><p>kind: Pod<br>
<!-- -->apiVersion: v1<br>
<!-- -->metadata:<br>
<!-- -->name: pod-matching-rs<br>
<!-- -->labels:<br>
<!-- -->environment: production<br>
<!-- -->spec:<br>
<!-- -->containers:  </p><ul><li>name: first-container<br>image: nginx</li></ul><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*HXUn4fXZciXXqtRl-R3ZuQ.png" class="img_ev3q"></p><p>Now we will run our previous yaml which will create a replicaSet object and run the two pods</p><p>kubectl create -f replicaSets.yaml<br>
<!-- -->kubectl get pods</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*jtQFpw5cpmxBPgHEob60iA.png" class="img_ev3q"></p><p>You can check whether the manual pod is managed by ReplicaSet or not</p><p>kubectl describe pod pod-matching-rs</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*SKiQEyQcFr-7L0hum8mv_A.png" class="img_ev3q"></p><p>so now when you delete the replicaSet then all pods will get deleted</p><p>kubectl delete rs nginx-replicaset</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="scale-your-replicas"><strong>Scale your replicas</strong><a href="#scale-your-replicas" class="hash-link" aria-label="Direct link to scale-your-replicas" title="Direct link to scale-your-replicas">​</a></h4><p>kubectl scale --replicas=4 rs nginx-replicaset</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*tyLpQHCKfQk2yUsJLPQqig.png" class="img_ev3q"></p><p>We have learnt how to use the ReplicaSet and when we should use this.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment"><strong>Deployment</strong><a href="#deployment" class="hash-link" aria-label="Direct link to deployment" title="Direct link to deployment">​</a></h3><p>A Deployment is a Kubernetes object that acts as a wrapper around a ReplicaSet and makes it easier to use.</p><p>It is recommended that we use Deployments that will manage the ReplicaSet and the Pods created by the ReplicaSet.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="few-use-cases"><strong>Few Use cases</strong><a href="#few-use-cases" class="hash-link" aria-label="Direct link to few-use-cases" title="Direct link to few-use-cases">​</a></h4><ul><li>Deployment maintains a history of revisions</li><li>A new revision is created whenever you change anything in replica or pod configuration</li><li>Easily rollback to the previous version</li><li>Each rollback also creates a new revision</li></ul><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*hyIJbaMwLuKxaJ2YOheSUg.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="strategy"><strong>Strategy</strong><a href="#strategy" class="hash-link" aria-label="Direct link to strategy" title="Direct link to strategy">​</a></h4><p>In the deployment spec we can specify which strategy the Deployment should use when it replaces old pods with new ones.</p><p>Two Types of Strategies</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="rollingupdate--default"><strong>RollingUpdate ( default)</strong><a href="#rollingupdate--default" class="hash-link" aria-label="Direct link to rollingupdate--default" title="Direct link to rollingupdate--default">​</a></h5><ul><li>Updates the deployment without downtime</li><li>Controller updates the pod one by one that means every time at least one pod is always running</li><li>With rolling update, there is a chance that at a particular time two versions(old and new) are running for your application. If your application is just serving the static information then this should be fine</li><li>In general, we can use <strong>RollingUpdate</strong> for applications for which the data stored by a new version can be read and handled by the old version of the application.</li></ul><p>spec:<br>
<!-- -->replicas: 3<br>
<strong>strategy</strong>:<br>
<!-- -->type: RollingUpdate<br>
<!-- -->rollingUpdate:<br>
<!-- -->maxUnavailable: 1<br>
<!-- -->maxSurge: 1</p><p><code>maxUnavailable:</code> This means maximum number of pods can go unavailable while doing the update. You can specify this value either as an <code>integer</code> or a string representing the percentage of total replicas that can be unavailable.</p><p>The default value for <strong>maxUnavailable</strong> is <strong>25%</strong>.</p><p><code>maxSurge:</code> is the maximum number of Pods that can be scheduled/created above the desired number of Pods (as specified in the <strong>replicas</strong> field).You can specify this value either as an <code>integer</code> or a percentage string.</p><p>The default value for <strong>maxSurge</strong> is also <strong>25%</strong>.</p><p>In the above example, we are telling Kubernetes controller that while updating the pod it can create /scheduled atmost 4 pods and one pod should always be in a running state.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="recreate"><strong>Recreate</strong><a href="#recreate" class="hash-link" aria-label="Direct link to recreate" title="Direct link to recreate">​</a></h5><ul><li>All the existing pods are killed before update</li><li>Downtime will be there while doing the update</li><li>Ensure that application is always running on one version</li><li>This is useful when application can’t be on different version at a particular time.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-simple-deployment-with-nginx-containers">Creating a Simple Deployment with Nginx Containers<a href="#creating-a-simple-deployment-with-nginx-containers" class="hash-link" aria-label="Direct link to Creating a Simple Deployment with Nginx Containers" title="Direct link to Creating a Simple Deployment with Nginx Containers">​</a></h3><p>apiVersion: apps/v1<br>
<!-- -->kind: Deployment<br>
<!-- -->metadata:<br>
<!-- -->name: nginx-deployment<br>
<!-- -->labels:<br>
<!-- -->app: nginx<br>
<!-- -->spec:<br>
<!-- -->replicas: 3<br>
<!-- -->selector:<br>
<!-- -->matchLabels:<br>
<!-- -->app: nginx<br>
<!-- -->environment: production<br>
<!-- -->template:<br>
<!-- -->metadata:<br>
<!-- -->labels:<br>
<!-- -->app: nginx<br>
<!-- -->environment: production<br>
<!-- -->spec:<br>
<!-- -->containers:  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx-container  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a Deployment</p><p>kubectl create -f deployment.yaml<br>
<!-- -->kubectl get deployment nginx-deployment</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*3ChsKk-IELHY6-TiacNKzQ.png" class="img_ev3q"></p><p>Deployment -&gt; Replica Set -&gt; 3 pods</p><p>This is how the naming convention also works. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rolling-back-a-deployment">Rolling Back a Deployment<a href="#rolling-back-a-deployment" class="hash-link" aria-label="Direct link to Rolling Back a Deployment" title="Direct link to Rolling Back a Deployment">​</a></h3><p> We can run the below command to check the revision history and rollback.</p><p>We should use <code>-record</code>when we use any <strong>apply</strong> or <strong>set</strong> commands to modify the Deployment. This flag records the rollout history.</p><p>kubectl rollout history deployment &lt;deployment<!-- -->_<!-- -->name&gt;<br>
<!-- -->kubectl rollout undo deployment &lt;deployment<!-- -->_<!-- -->name&gt;</p><p>To get more details about the deployment you can refer my blog on specifically <a href="https://devops4solutions.com/understand-kubernetes-object-and-create-nginx-deployment/" target="_blank" rel="noopener noreferrer">Deployment object</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="statefulsets">StatefulSets<a href="#statefulsets" class="hash-link" aria-label="Direct link to StatefulSets" title="Direct link to StatefulSets">​</a></h3><p>This is used to manage the stateful replicas. This is similar like Deployment which creates and manages the PODS as per the configuration.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-stateful-replicas-work"><strong>How stateful replicas work ?</strong><a href="#how-stateful-replicas-work" class="hash-link" aria-label="Direct link to how-stateful-replicas-work" title="Direct link to how-stateful-replicas-work">​</a></h4><p>It maintains a unique identity of the pods. Each pod is different and cannot be interchangeable.</p><p>Each of the Pods has a sticky identity that can be used by the application code to manage the state of the application on a particular Pod. </p><p> The names of the Pods reflect the integer identity assigned to them. When a StatefulSet is created, all the Pods are created in the order of their integer ordinal.</p><p>Each of the Pods managed by a StatefulSet will persist their sticky identity (integer ordinal) even if the Pod restarts. </p><p>For example, if a particular Pod crashes or is deleted, a new Pod will be created and assigned the same sticky identity as that of the old Pod.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-for-statefulsets">USE CASES FOR STATEFULSETS<a href="#use-cases-for-statefulsets" class="hash-link" aria-label="Direct link to USE CASES FOR STATEFULSETS" title="Direct link to USE CASES FOR STATEFULSETS">​</a></h4><ul><li>For the persistent storage. Using a StatefulSet, you can partition the data and store it in different Pods. In this case, it would also be possible for a Pod to go down and a new Pod come up with the same identity and have the same partition of data previously stored by the old Pod.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="daemon-sets">Daemon Sets<a href="#daemon-sets" class="hash-link" aria-label="Direct link to Daemon Sets" title="Direct link to Daemon Sets">​</a></h3><p>When you want to manage the creation of pods on a selected or on all the nodes that this object is being used.</p><p>If we configure a Daemon Set to create Pods on all nodes, then if new nodes are added to the cluster, new pods will be created to run on these new nodes. Similarly, if some nodes are removed from the cluster, the Pods running on these nodes will be destroyed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-for-daemonsets">Use Cases for DaemonSets<a href="#use-cases-for-daemonsets" class="hash-link" aria-label="Direct link to Use Cases for DaemonSets" title="Direct link to Use Cases for DaemonSets">​</a></h4><ul><li><strong>Logging</strong>: We need to run a logging pods on all the nodes so that we can collect metrics from all of them</li><li><strong>Local data caching</strong>: A DaemonSet can also be used to manage caching Pods on all the nodes. These Pods can be used by other application Pods to store the cached data temporarily.</li><li><strong>Monitoring</strong>: Another use case for a DaemonSet is to manage running monitoring Pods on all the nodes. </li></ul><p>All of these controllers <strong>(ReplicaSets, Deployment, Statefulets and Daemon Sets)</strong> have one common characteristic — they are useful for applications or workloads that are running continuously. </p><p>However, sometimes we just want to run a specific pod for a specific task and once the task is complete then we don’t need that pod. For this purpose, Kubernetes provides an object called <code>Job</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jobs"><strong>Jobs</strong><a href="#jobs" class="hash-link" aria-label="Direct link to jobs" title="Direct link to jobs">​</a></h3><p>Jobs can be used to manage Pods that are supposed to run a determined task and then terminate gracefully.</p><p><strong>Create a Job</strong></p><p>apiVersion: batch/v1<br>
<!-- -->kind: Job<br>
<!-- -->metadata:<br>
<!-- -->name: one-time-job<br>
<!-- -->spec:<br>
<!-- -->template:<br>
<!-- -->spec:<br>
<!-- -->containers:  </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: busybox-container  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: busybox  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args:  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - /bin/sh  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - -c  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - date; sleep 20; echo &quot;Bye&quot;  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  restartPolicy: OnFailure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a pod</p><p>kubectl apply -f jobs.yaml<br>
<!-- -->kubectl get jobs<br>
<!-- -->kubectl get pods<br>
<!-- -->kubectl logs -f one-time-job</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/880/1*gEoPt4KgImLu-gurSBO9jA.png" class="img_ev3q"></p><p>In the above screenshot, you can see that pod is in <code>completed</code> state and job is also successful.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion"><strong>Conclusion:</strong><a href="#conclusion" class="hash-link" aria-label="Direct link to conclusion" title="Direct link to conclusion">​</a></h3><p>We have successfully learnt all the Kubernetes objects using examples.</p><p>Want to learn more on Kubernetes, refer my <a href="https://devops4solutions.com/category/kubernetes/" target="_blank" rel="noopener noreferrer">website</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://devops4solutions.github.io/docs/edit/main/docs/Kubernetes/controllers.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Kubernetes/configmaps"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">configmaps</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Kubernetes/intro-kubernetes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">What is Kubernetes ?</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-controllers" class="table-of-contents__link toc-highlight"><strong>Why controllers ?</strong></a></li><li><a href="#replicasets" class="table-of-contents__link toc-highlight"><strong>ReplicaSets</strong></a></li><li><a href="#creating-a-simple-replicaset-with-nginx-containers" class="table-of-contents__link toc-highlight">Creating a Simple ReplicaSet with nginx Containers</a></li><li><a href="#deleting-pods-managed-by-a-replicaset" class="table-of-contents__link toc-highlight">Deleting Pods Managed by a ReplicaSet</a></li><li><a href="#creating-a-replicaset-given-that-a-matching-pod-alreadyexists" class="table-of-contents__link toc-highlight">Creating a ReplicaSet Given That a Matching Pod Already Exists</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight"><strong>Deployment</strong></a></li><li><a href="#creating-a-simple-deployment-with-nginx-containers" class="table-of-contents__link toc-highlight">Creating a Simple Deployment with Nginx Containers</a></li><li><a href="#rolling-back-a-deployment" class="table-of-contents__link toc-highlight">Rolling Back a Deployment</a></li><li><a href="#statefulsets" class="table-of-contents__link toc-highlight">StatefulSets</a></li><li><a href="#daemon-sets" class="table-of-contents__link toc-highlight">Daemon Sets</a></li><li><a href="#jobs" class="table-of-contents__link toc-highlight"><strong>Jobs</strong></a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight"><strong>Conclusion:</strong></a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.17cb328f.js"></script>
<script src="/assets/js/main.223e4706.js"></script>
</body>
</html>